---
import i18next, { t } from "i18next";

import BaseLayout from "@layouts/Base.astro";
import { Debug } from 'astro/components';

import cache from "@utils/cache.js";
import config from "@utils/config.js";
import directus from "@utils/directus.js";

const args = {
    locale: Astro.url.searchParams.get("locale") || 'en',
    id: Astro.url.searchParams.get("id") || 0
}
if (!args.id) {
    return await config.http404();
}



await i18next.changeLanguage(args.locale)


const cacheKey = `freport:${args.id}`;
let data
try {
    data = await cache.wrap(cacheKey, async function() {
        let query = await directus.items('report').readByQuery({
            filter: {
                id: {
                    _eq: args.id
                }
            },
            fields: [
                "id",
                "status",
                "photos.directus_files_id.id",
                "photos.directus_files_id.filename_disk",
                "photos.directus_files_id.type",
                "photos.directus_files_id.width",
                "photos.directus_files_id.height",
                "bike_brand_model.name",
                "bike_brand_model.bike_brand.name",
                "bike_brand_model.bike_brand.key",
                "language.locale_code",
                "main_photo.id",
                "main_photo.filename_disk",
                "main_photo.type",
                "main_photo.width",
                "main_photo.height"
            ]
        });
        return query && query.data && query.data.length == 1 ? query.data[0] : []


    }, { ttl: config.REPORT_OBJECT_CACHE_TTL })


    if (!data || data.length == 0) {
        return await config.http404()
    }

} catch (e) {
    throw e
}

---
<BaseLayout title={t('test.x')} description="test">
    <!-- <img src=`/photos/${data.main_photo.id}`> -->

    <Debug data={data}/>
</BaseLayout>